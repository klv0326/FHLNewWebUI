<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link rel="stylesheet" href="./libs/fhl.css"/>    
<script src="./libs/jquery-1.10.2.js"></script>
<script src="./libs/xml2json.min.js"></script>

<link rel="stylesheet" type="text/css" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css">
<script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
    
    
<script>

/*parameter setting*/
/**/

$(function(){
  //fhlTopMenu.init(pageState);
  //fhlTopMenu.render(pageState);
  fhlToolBar.init(pageState);
  fhlLeftWindow.init(pageState);
  fhlMidWindow.init(pageState);
  fhlInfo.init(pageState);  
});

var urlJSON="https://bkbible.fhl.net/json/";

var pageState={
    //Input Parameters
    //For qb.php
    engs:"Gen",
    chineses:"創",
    chap:1,
    sec:1,
    version:["unv"],    
    strong:0,
    gb:0,
    //For sc.php
    book:3,
    //For sd.php
    N:0,
    k:"",    
    //Return Values
    cname:["和合本"],
    //For popups
    realTimePopUp:0,
    //For fhlInfoContent
    titleId:"fhlInfoComment",
    //For fhlMidBottomWindow
    leftBtmWinShow:false,
    //For audio
    audio:0,
};
    
var chineseNumber=new Array( "零", "一", "二", "三", "四", "五", "六", "七", "八", "九", "十",
                            "十一", "十二", "十三", "十四", "十五", "十六", "十七", "十八", "十九", "二十",
                            "二十一", "二十二", "二十三", "二十四", "二十五", "二十六", "二十七", "二十八", "二十九", "三十",
                            "三十一", "三十二", "三十三", "三十四", "三十五", "三十六", "三十七", "三十八", "三十九", "四十",
                            "四十一", "四十二", "四十三", "四十四", "四十五", "四十六", "四十七", "四十八", "四十九", "五十",
                            "五十一", "五十二", "五十三", "五十四", "五十五", "五十六", "五十七", "五十八", "五十九", "六十",
                            "六十一", "六十二", "六十三", "六十四", "六十五", "六十六", "六十七", "六十八", "六十九", "七十",
                            "七十一", "七十二", "七十三", "七十四", "七十五", "七十六", "七十七", "七十八", "七十九", "八十",
                            "八十一", "八十二", "八十三", "八十四", "八十五", "八十六", "八十七", "八十八", "八十九", "九十",
                            "九十一", "九十二", "九十三", "九十四", "九十五", "九十六", "九十七", "九十八", "九十九", "一百",
                            "一百零一", "一百零二", "一百零三", "一百零四", "一百零五", "一百零六", "一百零七", "一百零八", "一百零九", "一百一十",
                            "一百一十一", "一百一十二", "一百一十三", "一百一十四", "一百一十五", "一百一十六", "一百一十七", "一百一十八", "一百一十九", "一百二十",
                            "一百二十一", "一百二十二", "一百二十三", "一百二十四", "一百二十五", "一百二十六", "一百二十七", "一百二十八", "一百二十九", "一百三十",
                            "一百三十一", "一百三十二", "一百三十三", "一百三十四", "一百三十五", "一百三十六", "一百三十七", "一百三十八", "一百三十九", "一百四十",
                            "一百四十一", "一百四十二", "一百四十三", "一百四十四", "一百四十五", "一百四十六", "一百四十七", "一百四十八", "一百四十九", "一百五十");

var book=new Array( "創","出","利","民","申","書","士","得","撒上","撒下","王上","王下",
                    "代上","代下","拉","尼","斯","伯","詩","箴","傳","歌","賽","耶",
                    "哀","結","但","何","珥","摩","俄","拿","彌","鴻","哈","番","該","亞","瑪",
                    "太","可","路","約","徒","羅","林前","林後","加","弗","腓","西",
                    "帖前","帖後","提前","提後","多","門","來","雅",
                    "彼前","彼後","約一","約二","約三","猶","啟");

var bookFullName=new Array( "創世記","出埃及記","利未記","民數記","申命記","約書亞記","士師記",
                            "路得記","撒母耳記上","撒母耳記下","列王紀上","列王紀下",
                            "歷代志上","歷代志下","以斯拉記","尼希米記","以斯帖記","約伯記",
                            "詩篇","箴言","傳道書","雅歌","以賽亞書","耶利米書",
                            "耶利米哀歌","以西結書","但以理書","何西阿書","約珥書","阿摩司書",
                            "俄巴底亞書","約拿書","彌迦書","那鴻書","哈巴谷書",
                            "西番雅書","哈該書","撒迦利亞書","瑪拉基書",
                            "馬太福音","馬可福音","路加福音","約翰福音","使徒行傳","羅馬書",
                            "哥林多前書","哥林多後書","加拉太書","以弗所書","腓立比書","歌羅西書",
                            "帖撒羅尼迦前書","帖撒羅尼迦後書","提摩太前書","提摩太後書",
                            "提多書","腓利門書","希伯來書","雅各書",
                            "彼得前書","彼得後書","約翰壹書","約翰貳書","約翰參書","猶大書","啟示錄");    
var bookChapters=new Array( 50,40,27,36,34,24,21,4,31,24,22,25,
                            29,36,10,13,10,42,150,31,12,8,66,52,
                            5,48,12,14,3,9,1,4,7,3,3,3,2,14,4,
                            28,16,24,21,28,16,16,13,6,6,4,4,
                            5,3,6,4,3,1,13,5,
                            5,3,5,1,1,1,22                            
                            );
var bookEng=new Array("Gen","Ex","Lev","Num","Deut","Josh","Judg","Ruth","1+Sam","2+Sam",
                "1+Kin","2+Kin","1+Chr","2+Chr","Ezra","Neh","Esth","Job","Ps","Prov",
                "Eccl","Song","Is","Jer","Lam","Ezek","Dan","Hos","Joel","Amos","Obad",
                "Jon","Mic","Nah","Hab","Zeph","Hag","Zech","Mal",
                "Matt","Mark","Luke","John","Acts","Rom","1+Cor","2+Cor","Gal","Eph",
                "Phil","Col","1+Thess","2+Thess","1+Tim","2+Tim","Titus","Philem",
                "Heb","James","1+Pet","2+Pet","1+John","2+John","3+John","Jude","Rev");    

function getAjaxUrl(func,ps,idx){
  var paramArr=new Array("engs","chineses","chap","sec","version",
                          "strong","gb","book","N","k");
  var urlParams={
    sc:[0,2,3,6,7],
    qb:[1,2,4,5,6],
    qp:[0,2,3,6],
    sd:[6,8,9]
  };  
  var getFullAjaxUrl=function(func,ps,idx){
    var ret=urlJSON+func+".php?";
    for(var i=0;i<urlParams[func].length;i++){
      if(paramArr[urlParams[func][i]]=="version"){
        ret+=paramArr[urlParams[func][i]];
        ret+="=";
        ret+=encodeURIComponent(ps[paramArr[urlParams[func][i]]][idx]);
        ret+="&";
      }else{
        ret+=paramArr[urlParams[func][i]];
        ret+="=";
        ret+=encodeURIComponent(ps[paramArr[urlParams[func][i]]]);
        ret+="&";        
      }
    };
    
    ret=ret.substring(0,ret.length-1);
    //console.log(ret);
    return ret;
  }
  return getFullAjaxUrl(func,ps,idx);
}

function getBookFunc(func,bookName){
  var i;
  for(i=0;i<book.length;i++)
    if(book[i]==bookName)break;
  var ret;
  switch(func){
    case "index":
      ret=i;
      break;
    case "indexByEngs":
      for(i=0;i<bookEng.length;i++)
        if(bookEng[i]==bookName)break;
      ret=i;
      break;
    case "bookFullName":
      ret=bookFullName[i];
      break;
    case "bookChapters":
      ret=bookChapters[i];
      break;
    case "bookEng":
      ret=bookEng[i];
      break;
    default:
      ret="failed";
      break;
  }
  return ret;
}

/***** Start of fhlToolBar *****/
    
var bookSelectChapterAutoCloseTimeout;
var bookSelectAutoCloseTimeout;

var fhlToolBar={
    init:function(ps){
        //this.registerEvents();
        searchTool.init(ps,$('#searchTool'));
        searchTool.registerEvents(ps);
        bookSelect.init(ps,$('#bookSelect'));
        versionSelect.init(ps,$('#versionSelect'));
        versionSelect.registerEvents(ps);
        
        windowControl.init(ps,$('#windowControl'));
        windowControl.registerEvents(ps);
    }
};

var searchTool={
  init:function(ps,dom){
    this.dom=dom;
    this.render(ps,this.dom);
  },
  registerEvents:function(ps){
  },
  render:function(ps,dom){
    var html="";
    html+="<input type=text class='searchBox'></input>";
    html+="<span class='searchBtn'>快速搜尋</span>";
    dom.html(html);
  }
};
    
var bookSelect={
  init:function(ps,dom){    
    this.dom=dom;
    this.render(ps,this.dom);
    bookSelectPopUp.init(ps,$('#bookSelectPopUp'));
    bookSelectPopUp.registerEvents(ps);    
  },
  registerEvents:function(ps){
    var that=this;
    $('#bookSelect').unbind().click(function(e){// 加上unbind() 讓創世記第二章之後的dropdown不會自動消失
        if(bookSelectPopUp.dom.is(":visible")){
            bookSelectPopUp.dom.fadeOut('0.2');
            setTimeout(function(){
                bookSelect.dom.css({'color': '#000000'});
            }, 200);
        }
        else{
            if(versionSelectPopUp.dom.is(":visible"))
                setTimeout(function(){ bookSelectPopUp.dom.fadeIn('0.2'); }, 200);
            else
                bookSelectPopUp.dom.fadeIn('0.2');
            setTimeout(function(){ versionSelect.dom.css({'color': '#000000'}); }, 200);
            versionSelectPopUp.dom.fadeOut('0.2');
            bookSelect.dom.css({'color': '#00A0FF'});
        }
        e.stopPropagation();
    });
    $(document).click(function() {
        bookSelectPopUp.dom.fadeOut('0.2');
        setTimeout(function(){ bookSelect.dom.css({'color': '#000000'}); }, 200);
    });
    $('#bookSelect').mouseenter(function(){
        if(!bookSelectPopUp.dom.is(":visible")){
            bookSelect.dom.css({'color': '#00A0FF'});
        }
    });
    $('#bookSelect').mouseleave(function(){
        if(!bookSelectPopUp.dom.is(":visible")){
            bookSelect.dom.css({'color': '#000000'});
        }
    });

    /*$('.chapBack').click(function(e){
      //versionSelectPopUp.dom.fadeOut('0.2');
      var idx=getBookFunc("index",ps.chineses);
      if(ps.chap==1){
        ps.chineses=book[idx-1];
        ps.engs=bookEng[idx-1];
        ps.chap=bookChapters[idx-1];
      }else{
        ps.chap--;        
      }
      that.render(ps,that.dom);
      fhlLecture.render(ps,fhlLecture.dom);
      fhlInfo.render(ps);
      //bookSelectPopUp.dom.fadeOut('0.2');
      e.stopPropagation();
    });
    $('.chapNext').click(function(e){      
      //versionSelectPopUp.dom.fadeOut('0.2');
      var idx=getBookFunc("index",ps.chineses);
      if(ps.chap==bookChapters[idx]){//if last chapter
        ps.chineses=book[idx+1];//book+1
        ps.engs=bookEng[idx+1];
        ps.chap=1;
      }else{
        ps.chap++;
      }
      that.render(ps,that.dom);
      fhlLecture.render(ps,fhlLecture.dom);
      fhlInfo.render(ps);
      //bookSelectPopUp.dom.fadeOut('0.2');
      e.stopPropagation();
    });*/
    
  },
  render:function(ps,dom){
      var bookName=getBookFunc("bookFullName",ps.chineses);
      var html="";
      if(bookName!="詩篇")
          html=bookName+"： 第"+chineseNumber[ps.chap]+"章";
      else
          html=bookName+"： 第"+chineseNumber[ps.chap]+"篇";
      html+='&nbsp;&#9660;';
      dom.html(html);
      this.registerEvents(ps);
  }
};

var bookSelectPopUp={
  init:function(ps,dom){
    this.dom=dom;
    bookSelectName.init(ps,$('#bookSelectName'));    
    bookSelectName.registerEvents(ps);
    this.dom.hide();
  },
  registerEvents:function(ps){
    var that=this;
    this.dom.click(function(e) {
        e.stopPropagation();
    });
  }
};

var bookSelectName={
  init:function(ps,dom){
    this.dom=dom;
    this.render(ps,this.dom);
  },
  registerEvents:function(ps){
    var that=this.dom;
    var isBookSelectChapterPopUp=false;
    this.dom.find('li li').click(function(){
        if(isBookSelectChapterPopUp===false){
            var idx=getBookFunc("index",$(this).attr('chineses'));
            var position=$(this).position();
            position.left=$(this).position().left;
            position.top=$(this).position().top+$(this).height()+10;
            bookSelectChapter.init(ps,$('#bookSelectChapter'),idx,position);
            bookSelectChapter.registerEvents(ps);
            that.find('li').removeClass('selected');
            $(this).addClass('selected');
            isBookSelectChapterPopUp=true;
            bookSelectChapter.dom.hide();
            bookSelectChapter.dom.show('0.2');
        }
        else{
            bookSelectChapter.dom.hide('0.2');
            isBookSelectChapterPopUp=false;
            that.find('li').removeClass('selected');
        }
    });
    this.dom.find('li li').mouseenter(function(){
        clearTimeout(bookSelectAutoCloseTimeout);
        that.find('li').removeClass('selected');
        if(isBookSelectChapterPopUp===true){
            bookSelectChapter.dom.hide('0.2');
            isBookSelectChapterPopUp=false;
        }
    });
    this.dom.find('li li').mouseleave(function(){
        bookSelectChapterAutoCloseTimeout = setTimeout(function(){
            if(isBookSelectChapterPopUp===true){
                bookSelectChapter.dom.hide('0.2');
                isBookSelectChapterPopUp=false;
                that.find('li').removeClass('selected');
            }
        }, 100);
    });
  },
  render:function(ps,dom){
      var html="<div id='old-testament'>舊約<ul><li><span>摩西五經</span><ul>";
      for(var i=0;i<5;i++)
          html+="<li>"+bookFullName[i]+"</li>";
      html+="</ul></li><li><span>歷史書</span><ul>";
      for(var i=5;i<17;i++)
          html+="<li>"+bookFullName[i]+"</li>";
      html+="</ul></li><li><span>詩歌智慧書</span><ul>";
      for(var i=17;i<22;i++)
          html+="<li>"+bookFullName[i]+"</li>";
      html+="</ul></li><li><span>大先知書</span><ul>";
      for(var i=22;i<27;i++)
          html+="<li>"+bookFullName[i]+"</li>";
      html+="</ul></li><li><span>小先知書</span><ul>";
      for(var i=27;i<39;i++)
          html+="<li>"+bookFullName[i]+"</li>";
      html+="</ul></li></ul></div><div id='new-testament'>新約<ul><li><span>福音、歷史書</span><ul>";
      for(var i=39;i<44;i++)
          html+="<li>"+bookFullName[i]+"</li>";
      /*html+="</ul></li><li><span>歷史書</span><ul>";
      for(var i=43;i<44;i++)
          html+="<li>"+bookFullName[i]+"</li>";*/
      html+="</ul></li><li><span>保羅書信</span><ul>";
      for(var i=44;i<57;i++)
          html+="<li>"+bookFullName[i]+"</li>";
      html+="</ul></li><li><span>其他、預言書</span><ul>";
      for(var i=57;i<66;i++)
          html+="<li>"+bookFullName[i]+"</li>";
      /*html+="</ul></li><li><span>預言書</span><ul>";
      for(var i=65;i<66;i++)
          html+="<li>"+bookFullName[i]+"</li>";*/
      html+="</ul></li></ul></div>";
 
      dom.html(html);
      
      for(var i=0;i<bookFullName.length;i++){
          dom.find('li li:eq('+i+')').attr('chineses',book[i]);
      }
    /*for(var i=0;i<bookFullName.length;i++){
      dom.find('li:eq('+i+')').attr('chineses',book[i]);
    }*/
  }
};

var bookSelectChapter={
  init:function(ps,dom,idx,position){
    this.dom=dom;
    this.idx=idx;
    this.dom.css({
        'position': 'absolute',
        'left':position.left,
        'top':position.top,
        'box-shadow':'3px 5px 3px 1px rgba(0,0,0,0.75)',
        'border': 'solid white 2px'
    });
    this.render(ps,this.dom,this.idx);
  },
  registerEvents:function(ps){
    var that=this;
    this.dom.find('li').click(function(){
      ps.chineses=book[that.idx];
      ps.engs=bookEng[that.idx];
      ps.chap=parseInt($(this).attr('chap'));
      ps.sec=1;
      bookSelect.render(ps,bookSelect.dom);
      fhlLecture.render(ps,fhlLecture.dom);
      //fhlInfo.render(ps);
      bookSelectPopUp.dom.hide();
      bookSelect.dom.css({'color': '#000000'});
    });
    this.dom.mouseenter(function(){
        clearTimeout(bookSelectChapterAutoCloseTimeout);
    });
    this.dom.mouseleave(function(){
        bookSelectChapter.dom.hide('0.2');
        bookSelectName.dom.find('li li').removeClass('selected');
    });
  },
  render:function(ps,dom,idx){
    var numOfChapters=bookChapters[idx];
    var html="<ul>";
    for(var i=1;i<=numOfChapters;i++){
      html+="<li>"+i+"</li>";
    }
    dom.html(html);
    for(var i=0;i<numOfChapters;i++){
      dom.find('li:eq('+i+')').attr('chap',i+1);
    }
  }
};

var versionSelect={
    init:function(ps,dom){
        this.dom=dom;
        this.render(ps,this.dom);
        //position of Popup
        var offset=this.dom.offset();
        offset.top+=this.dom.height();
        versionSelectPopUp.init(ps,$('#versionSelectPopUp'),offset);
    },
    registerEvents:function(ps){
        var that=this;
        this.dom.click(function(e){
            if(!versionSelectPopUp.dom.is(":visible")){
                bookSelectPopUp.dom.fadeOut('0.2');
                bookSelect.dom.css({'color': '#000000'});
                
                /*var position=$(this).position();
                position.left=$(this).position().left;
                position.top=$(this).position().top+$(this).height()+40;
                versionSelectPopUp.dom.css({'position': 'fixed', 'left':position.left, 'top':position.top});*/
                
                if(bookSelectPopUp.dom.is(":visible"))
                    setTimeout(function(){ versionSelectPopUp.dom.fadeIn('0.2'); }, 200);
                else
                    versionSelectPopUp.dom.fadeIn('0.2');
                versionSelect.dom.css({'color': '#00A0FF'});
                isVersionSelectPopUp = true;
            }
            else{
                versionSelectPopUp.dom.fadeOut('0.2');
                setTimeout(function(){ versionSelect.dom.css({'color': '#000000'}); }, 200);
                isVersionSelectPopUp = false;
            }
            e.stopPropagation();
        });
        $(document).click(function() {
            versionSelectPopUp.dom.fadeOut('0.2');
            setTimeout(function(){ versionSelect.dom.css({'color': '#000000'}); }, 200);
        });
        $('#versionSelect').mouseenter(function(){
            if(!versionSelectPopUp.dom.is(":visible")){
                versionSelect.dom.css({'color': '#00A0FF'});
            }
        });
        $('#versionSelect').mouseleave(function(){
            if(!versionSelectPopUp.dom.is(":visible")){
                versionSelect.dom.css({'color': '#000000'});
            }
        });
    },
    render:function(ps,dom){
        dom.html("聖經版本&nbsp;&#9660;");
    }
};
var versionSelectPopUp={
  init:function(ps,dom,offset){
    this.dom=dom;
    this.dom.offset(offset);
    var that=this;    
    var ajaxUrl=urlJSON+"abv.php";
    $.ajax({
      url:ajaxUrl
    }).done(function(d,s,j){
      if(j){
        var jsonObj=JSON.parse(j.responseText);
        that.data=jsonObj;
      }    
      that.render(ps,dom,that.data);  
    });        
    this.dom.hide();
  },
  registerEvents:function(ps){
    var that=this;
    /*this.dom.mouseleave(function(){
      that.dom.fadeOut('0.2');
      versionSelect.dom.css({'background-color': '#F3F3F3'});
    });*/
    this.dom.find('li').click(function(e){
      $(this).toggleClass('selected');
      if($(this).hasClass('selected')){
        ps.version.push($(this).attr('book'));
        ps.cname.push($(this).attr('cname'));
      }else{
        var idx=ps.version.indexOf($(this).attr('book'));
        ps.version.splice(idx,1);
        ps.cname.splice(idx,1);
      }
      //Set Default version?      
      if(ps.version.length==0){
        var o=that.dom.find('li:eq(0)');
        ps.version.push(o.attr('book'));
        ps.cname.push(o.attr('cname'));
      }
      that.render(ps,that.dom,that.data);
      fhlLecture.render(ps,fhlLecture.dom);
      e.stopPropagation();
    });
  },  
  render:function(ps,dom,data){
    var that=this;
    var html="<ul>";
    for(var i=0;i<data.record_count;i++){
      var o=data.record[i];
      html+="<li>"+o.cname+"</li>";
    }
    html+="</ul>";
    dom.html(html);
    for(var i=0;i<data.record_count;i++){
      var o=data.record[i];
      dom.find('li:eq('+i+')').attr(o);
    }        
    dom.find('li').removeClass('selected');
    for(var i=0;i<ps.version.length;i++){
      var v=ps.version[i];
      var li=dom.find('li[book="'+v+'"]');
      if(li!=null){
        li.each(function(){
          $(this).addClass('selected');
          var html=$(this).html();
          html+="&#x2713";
          $(this).html(html);
        });
      }
    }
    that.registerEvents(ps);    
  }
};

var windowControl={
  init:function(ps,dom){
    this.dom=dom;
    this.render(ps,this.dom);
    this.registerEvents(ps);
  },
  registerEvents:function(ps){
      $('#fhlLeftWindowControl').click(function(){
          if($('#fhlLeftWindow').css('left')=='0px'){
              $('#fhlLeftWindowControl').hover(function() {
                  $(this).css({'color': '#00A0FF'});
              }, function() {
                  $(this).css({'color': '#0050FF'});
              });
              var fhlLeftWindowWidth = $("#fhlLeftWindow").width();
              $("#fhlLeftWindow").animate({left: -fhlLeftWindowWidth-5 + 'px'});
              $("#fhlMidWindow").animate({left: '0px', width: $("#fhlMidWindow").width() + fhlLeftWindowWidth + 'px'});
          }
          else{
              $('#fhlLeftWindowControl').hover(function() {
                  $(this).css({'color': '#00A0FF'});
              }, function() {
                  $(this).css({'color': '#000000'});
              });
              var fhlLeftWindowWidth = $("#fhlLeftWindow").width();
              $("#fhlLeftWindow").animate({left: '0px'});
              $("#fhlMidWindow").animate({left: fhlLeftWindowWidth + 'px', width: $("#fhlMidWindow").width() - fhlLeftWindowWidth + 'px'});
          }
      });
      $('#fhlMidBottomWindowControl').click(function(){
          if($('#fhlMidBottomWindow').css('bottom')=='0px'){
              $('#fhlMidBottomWindowControl').hover(function() {
                  $(this).css({'color': '#00A0FF'});
              }, function() {
                  $(this).css({'color': '#0050FF'});
              });
              var fhlMidBottomWindowHeight = $("#fhlMidBottomWindow").height();
              $("#fhlMidBottomWindow").animate({top: $('#fhlMidWindow').height()+5+'px', bottom: -fhlMidBottomWindowHeight-5 + 'px'});
              $("#fhlLecture").animate({bottom: '0px', height: $("#fhlLecture").height() + fhlMidBottomWindowHeight + 'px'});
          }
          else{
              $('#fhlMidBottomWindowControl').hover(function() {
                  $(this).css({'color': '#00A0FF'});
              }, function() {
                  $(this).css({'color': '#000000'});
              });
              var fhlMidBottomWindowHeight = $("#fhlMidBottomWindow").height();
              $("#fhlMidBottomWindow").animate({top: $('#fhlMidWindow').height()-fhlMidBottomWindowHeight+'px', bottom: '0px'});
              $("#fhlLecture").animate({bottom: fhlMidBottomWindowHeight + 'px', height: $("#fhlLecture").height() - fhlMidBottomWindowHeight + 'px'});
          }
      });
      $('#fhlInfoWindowControl').click(function(){
          if($('#fhlInfo').css('right')=='0px'){
              $('#fhlInfoWindowControl').hover(function() {
                  $(this).css({'color': '#00A0FF'});
              }, function() {
                  $(this).css({'color': '#0050FF'});
              });
              var fhlInfoWidth = $("#fhlInfo").width();
              $("#fhlInfo").animate({left: $(window).width() + 5 + 'px', right: -fhlInfoWidth-5 + 'px', width: fhlInfoWidth});
              $("#fhlMidWindow").animate({right: '0px', width: $("#fhlMidWindow").width() + fhlInfoWidth + 'px'});
          }
          else{
              $('#fhlInfoWindowControl').hover(function() {
                  $(this).css({'color': '#00A0FF'});
              }, function() {
                  $(this).css({'color': '#000000'});
              });
              var fhlInfoWidth = $("#fhlInfo").width();
              $("#fhlInfo").animate({left: $(window).width()-fhlInfoWidth + 'px', right: '0px'});
              $("#fhlMidWindow").animate({right: fhlInfoWidth + 'px', width: $("#fhlMidWindow").width() - fhlInfoWidth + 'px'});
          }
      });
  },
  render:function(ps,dom){
    var html="<span id='fhlLeftWindowControl' style='top: -1px; padding: 1px 7px 4px 7px; border-bottom-left-radius: 3px; border-top-left-radius: 3px; border-width: 1px;'>&#8647;</span><span id='fhlMidBottomWindowControl' style='top: 0px; padding-top: 2px;'>&#8650;</span><span id='fhlInfoWindowControl' style='top: -1px; padding: 1px 7px 4px 7px; border-bottom-right-radius: 3px; border-top-right-radius: 3px;'>&#8649;</span>";
    dom.html(html);
  }
}
    
/***** End of fhlToolBar *****/
    
/***** Start of fhlLeftWindow *****/
    
var fhlLeftWindow={
  init:function(ps){
      this.registerEvents();
      settings.init(ps,$('#setting'));
      settings.registerEvents(ps);
  },
  registerEvents:function(){
      $('#fhlLeftWindow').resizable({
        handles: 'e',
        maxWidth: 450,
        minWidth: 120,
        resize: function(event, ui){
          var currentWidth = ui.size.width;
          var width;
            if($("#fhlInfo").css('right')=='0px')
                width=$(window).width()-$("#fhlInfo").width()-currentWidth;
            else 
                width=$(window).width()-currentWidth;
          $("#fhlMidWindow").css({
              'width': width+'px',
              'left': currentWidth+'px'
          });
        }
      });
  }
};
    
var settings={
    init:function(ps,dom){
        this.dom=dom;
        this.render(ps,this.dom);
        snSelect.init(ps,$('#snSelect'));
        snSelect.registerEvents(ps);
        realTimePopUpSelect.init(ps,$('#realTimePopUpSelect'));
        realTimePopUpSelect.registerEvents(ps);
        gbSelect.init(ps,$('#gbSelect'));
        gbSelect.registerEvents(ps);
        mapTool.init(ps,$('#mapTool'));
        mapTool.registerEvents(ps);
        imageTool.init(ps,$('#imageTool'));
        imageTool.registerEvents(ps);
    },
    registerEvents:function(ps){
        $('#settings p')
            .css({cursor: "pointer"})
            .on('click', function(){
            var html =  $(this).html() == "▼&nbsp;設定"?"&#9654;&nbsp;設定":"&#9660;&nbsp;設定";
            $(this).html(html);
            $(this).next().slideToggle();
        });
    },
    render:function(ps,dom){
        //dom.html("設定");
    }
};

var snSelect={
    init:function(ps,dom){
        this.dom=dom;
        this.render(ps,this.dom);
    },
    registerEvents:function(ps){
        $('#snOnOffSwitch').change(
        function(){
            if ($(this).is(':checked')) {
                ps.strong=1;
                fhlLecture.render(ps,fhlLecture.dom);
            }
            else{
                ps.strong=0;
                fhlLecture.render(ps,fhlLecture.dom);
            }
        });
    },
    render:function(ps,dom){
        var html="<div>原文編號</div>";
        html+='<div class="onOffSwitch">\
                    <input type="checkbox" name="snOnOffSwitch" class="onOffSwitch-checkbox" id="snOnOffSwitch">\
                    <label class="onOffSwitch-label" for="snOnOffSwitch">\
                        <span class="onOffSwitch-inner"></span>\
                        <span class="onOffSwitch-switch"></span>\
                    </label>\
                </div>';
        dom.html(html);
    }
};
var gbSelect={
  init:function(ps,dom){
    this.dom=dom;
    this.render(ps,this.dom);
  },
  registerEvents:function(ps){
      $('#gbSelectSwitch').change(
        function(){
            if ($(this).is(':checked')) {
                ps.gb=1;
                fhlLecture.render(ps,fhlLecture.dom);
            }
            else{
                ps.gb=0;
                fhlLecture.render(ps,fhlLecture.dom);
            }
        });
  },
  render:function(ps,dom){
      var html="<div>繁簡切換</div>";
        html+='<div class="onOffSwitch">\
                    <input type="checkbox" name="gbSelectSwitch" class="onOffSwitch-checkbox" id="gbSelectSwitch">\
                    <label class="onOffSwitch-label" for="gbSelectSwitch">\
                        <span class="onOffSwitch-inner traditional-simpleSwitch"></span>\
                        <span class="onOffSwitch-switch"></span>\
                    </label>\
                </div>';
        dom.html(html);
  }
};
var realTimePopUpSelect={
  init:function(ps,dom){
    this.dom=dom;
    this.render(ps,this.dom);
  },
  registerEvents:function(ps){
      $('#realTimeOnOffSwitch').change(
        function(){
            if ($(this).is(':checked')) {
                ps.realTimePopUp=1;
                fhlLecture.render(ps,fhlLecture.dom);
            }
            else{
                ps.realTimePopUp=0;
                fhlLecture.render(ps,fhlLecture.dom);
            }
        });
  },
  render:function(ps,dom){
      var html="<div>即時顯示</div>";
        html+='<div class="onOffSwitch">\
                    <input type="checkbox" name="realTimeOnOffSwitch" class="onOffSwitch-checkbox" id="realTimeOnOffSwitch">\
                    <label class="onOffSwitch-label" for="realTimeOnOffSwitch">\
                        <span class="onOffSwitch-inner"></span>\
                        <span class="onOffSwitch-switch"></span>\
                    </label>\
                </div>';
        dom.html(html);
  }
};
var mapTool={
  init:function(ps,dom){
    this.dom=dom;
    this.render(ps,this.dom);
  },
  registerEvents:function(ps){
  },
  render:function(ps,dom){
    var html="<div>地圖顯示</div>";
        html+='<div class="onOffSwitch">\
                    <input type="checkbox" name="mapToolOnOffSwitch" class="onOffSwitch-checkbox" id="mapToolOnOffSwitch">\
                    <label class="onOffSwitch-label" for="mapToolOnOffSwitch">\
                        <span class="onOffSwitch-inner"></span>\
                        <span class="onOffSwitch-switch"></span>\
                    </label>\
                </div>';
        dom.html(html);
  }
};
var imageTool={
  init:function(ps,dom){
    this.dom=dom;
    this.render(ps,this.dom);
  },
  registerEvents:function(ps){
  },
  render:function(ps,dom){
    var html="<div>圖片顯示</div>";
        html+='<div class="onOffSwitch">\
                    <input type="checkbox" name="imageToolOnOffSwitch" class="onOffSwitch-checkbox" id="imageToolOnOffSwitch">\
                    <label class="onOffSwitch-label" for="imageToolOnOffSwitch">\
                        <span class="onOffSwitch-inner"></span>\
                        <span class="onOffSwitch-switch"></span>\
                    </label>\
                </div>';
        dom.html(html);
  }
};
    
    
    
/***** End of fhlLeftWindow *****/

/***** Start of fhlMidWindow *****/
var fhlMidWindow={
    init:function(ps,dom){
        this.dom=dom;
        fhlLecture.init(pageState,$('#fhlLecture'));
        fhlMidBottomWindow.init(pageState,$('#fhlMidBottomWindow'));
        this.render(ps,dom);
    },
    render:function(ps,dom){
        var width=$(window).width()-$("#fhlLeftWindow").width()-$("#fhlInfo").width();
        $("#fhlMidWindow").css({
            'width': width+'px'
        });
    }
}
    
function setCSS(col,ps){
  var totalWidth=100;
  $('.lecContent').css('width',(totalWidth/col)+"%");
  $('.lecVersion').css('width',(totalWidth/col)+"%");
}

function getBibleText(col,ps,cbk,defCbk){
  var sem=col;
  //console.log("enter getBibleText");
  for(var i=0;i<col;i++){
    //console.log("launch ajax"+i);
    var ajaxUrl=getAjaxUrl("qb",ps,i);    
    $.ajax({
      url:ajaxUrl
    }).done(function(d,s,j){
      if(j){
        //console.log(j.responseText);
        var jsonObj=JSON.parse(j.responseText);
        cbk(jsonObj);
        sem--;
      }
    });
  }  
  var def=setInterval(function(){
    if(sem==0){
      defCbk();
      clearInterval(def);
    }
  },100);
}

function checkOldNew(ps){
//0 - Old 
//1 - New
  return (book.indexOf(ps.chineses)>=39)?0:1;  
}

function parseBibleText(text,ps,isOld,bibleVersion){
  var ret;
  checkOldNew(ps);
  switch(ps.strong){
    case 0:
      ret=text;
      break;
    case 1:
      //console.log(text);
      if(bibleVersion=="和合本"||bibleVersion=="KJV"){
        text=text.replace(/[{}]/g,"");
        text=text.replace(/>/g,"&gt;</span>");
        text=text.replace(/<W[a-zA-Z]*/g,"<span class='sn' N="+isOld+">&lt;");
      }
      //console.log(text);
      ret=text;
      break;
    default:
      ret=text;
      break;
  }
  return ret;
}

function getRecord(r,b,c,s){
  var ret=null;
  for(var i=0;i<r.length;i++){
    if(r[i]==null)
      break;
    if(r[i].chap==c&&r[i].sec==s){
      ret=r[i];
      break;
    }
  }
  return ret;
}

function sortBibleVersion(r,ps){
  var tmpArr=new Array();
  for(var i=0;i<ps.version.length;i++){
    var version=ps.version[i];
    for(var j=0;j<r.length;j++){
      if(version==r[j].version){
        tmpArr.push(r[j]);
      }
    }
  }
  return tmpArr;
}

var fhlLecture={
  init:function(ps,dom){
    this.dom=dom;
    this.render(ps,dom);
  },
  selectLecture:function(book,chap,sec){
    var that=this.dom;
    that.find('.lec').removeClass('selected');
    that.find('.lec'+'[sec="'+sec+'"]').addClass('selected');
  },
  registerEvents:function(ps){
    var that=this.dom;
    that.find('.lec').click(function(){
      ps.sec=parseInt($(this).attr('sec'));
      ps.chap=parseInt($(this).attr('chap'));
      $(that).find('.lec').removeClass('selected');
      $(this).addClass('selected');
      fhlInfo.render(ps);
    });
    if(ps.realTimePopUp==1){
      $('.sn').mouseenter(function(){
        var offset=$(this).offset();
        offset.top+=$(this).height()+10;
        ps.N=$(this).attr('N');
        ps.k=$(this).html();
        parsingPopUp.render(ps,parsingPopUp.dom,offset);
      });
    }else{
      $('.sn').click(function(){
        var offset=$(this).offset();
        offset.top+=$(this).height()+10;
        ps.N=$(this).attr('N');
        ps.k=$(this).html();
        parsingPopUp.render(ps,parsingPopUp.dom,offset);
      });    
    }
    $('.chapBack').click(function(e){
      var idx=getBookFunc("index",ps.chineses);
      if(ps.chap==1){
        ps.chineses=book[idx-1];
        ps.engs=bookEng[idx-1];
        ps.chap=bookChapters[idx-1];
      }else{
        ps.chap--;        
      }
      fhlLecture.render(ps,fhlLecture.dom);
      //fhlInfo.render(ps);
      bookSelect.render(ps, bookSelect.dom);
      e.stopPropagation();
    });
    $('.chapNext').click(function(e){      
      var idx=getBookFunc("index",ps.chineses);
      if(ps.chap==bookChapters[idx]){//if last chapter
        ps.chineses=book[idx+1];//book+1
        ps.engs=bookEng[idx+1];
        ps.chap=1;
      }else{
        ps.chap++;
      }
      fhlLecture.render(ps,fhlLecture.dom);
      //fhlInfo.render(ps);
      bookSelect.render(ps, bookSelect.dom);
      e.stopPropagation();
    });
    /*$('.sn').mouseleave(function(){
      parsingPopUp.dom.hide();
    });*/
  },
  render:function(ps,dom){
    var that=this;
    var htmlTitle="";
    var htmlContent="";
    var col=ps.version.length;
    var rspArr=new Array();
    var idx=0;
    getBibleText(col,ps,function(o){
        rspArr.push(o);
    },function(){                
      var isOld=checkOldNew(ps);
      var maxRecordCnt=0;
      var maxRecordIdx=0;
      rspArr=sortBibleVersion(rspArr,ps);
      for(var i=0;i<rspArr.length;i++){
        var o=rspArr[i];
        htmlTitle+="<div class=lecContent><div class=versionName>"+o.v_name+"<span class='closeButton'>&#215</span></div></div>";
        if(rspArr[i].record_count>maxRecordCnt){
          maxRecordCnt=rspArr[i].record_count;
          maxRecordIdx=i;          
          //console.log("maxRecordCnt:"+maxRecordCnt+",maxRecordIdx:"+maxRecordIdx);
        }        
      }        
      for(var i=0;i<maxRecordCnt;i++){
        var maxR=rspArr[maxRecordIdx].record[i];
        htmlContent+="<div class=lec>";
        //htmlContent+="<div class=lecTitle>"+maxR.chap+":"+maxR.sec+"</div>";
        for(j=0;j<rspArr.length;j++){
          var chap=maxR.chap,sec=maxR.sec;                
          var rec=getRecord(rspArr[j].record,null,chap,sec);
          //var r=rspArr[j].record[i];
          if(rec!=null){
            var bibleText=parseBibleText(rec.bible_text,ps,isOld,rspArr[j].v_name);
            if(bibleText=="a")
                bibleText="【併入上節】";
          }else{
            bibleText="";
          }
          htmlContent+="<div class='lecContent'><div style='margin: 0px 20px 0px 1px; padding: 7px 0px; height: 100%;'><span class='verseNumber'>"+maxR.sec+"</span>"+bibleText+"</div></div>";
        }
        htmlContent+="</div>";        
      }
      
      var control_str="";
      var bookName=getBookFunc("bookFullName",ps.chineses);
      if(bookName!="failed"){
        if(ps.chineses==book[0]&&ps.chap==1){
          control_str+="";
        }else{
          control_str+="<div class='chapBack chapControl' style='left: 0px;'><span>&#x276e;</span></div>";
        }      
        /*control_str+="<span class='chapSelect'>"+bookName;
        control_str+="&nbsp&nbsp"+ps.chap+"</span>";*/
        if(ps.chineses==book[65]&&ps.chap==22){
          control_str+="";
        }else{
          control_str+="<div class='chapNext chapControl' style='right: 0px;'><span>&#x276f;</span></div>";
        }            
      }
        
      var html=control_str+'<div id="lecMainTitle" style="margin: 0px 50px; z-index: 2;">'+htmlTitle+'</div>';
      html+='<div id="lecMain">'+htmlContent+'</div>';
      dom.html(html);
      for(var i=0;i<maxRecordCnt;i++){
        var r=rspArr[maxRecordIdx].record[i];
        dom.find('.lec:eq('+i+')').attr('chap',r.chap);
        dom.find('.lec:eq('+i+')').attr('sec',r.sec);
      }
      setCSS(col,ps);
      dom.scrollTop(0);
      that.selectLecture(null,null,1);
      that.registerEvents(ps);      
    });
  }
};

var fhlMidBottomWindow={
  init:function(ps,dom){
    this.dom=dom;
    this.render(ps,dom);
    this.registerEvents(ps);
  },
  registerEvents:function(ps){
      $('#fhlMidBottomWindow').resizable({
        handles: 'n',
        maxHeight: 600,
        minHeight: 100,
        resize: function(event, ui){
          var currentHeight = ui.size.height;
          var height=$(window).height()-currentHeight-80;
          $("#fhlLecture").css({
              'height': height+'px',
          });
          $(this).css({
              'width': '100%'
          });
        }
      });
    /*$('#fhlMidBottomWindowTitle').click(function(){
      if(ps.leftBtmWinShow==true){
        var fhlMidWindowH=$('#fhlMidWindow').height();
        $('#fhlMidBottomWindow').height(fhlMidWindowH*0.1);//50%->5%
        var fhlMidBottomWindowH=$('#fhlMidBottomWindow').height();
        $('#fhlMidBottomWindowTitle').height(fhlMidBottomWindowH);
        $('#fhlMidBottomWindowContent').height(0);
        $('#fhlLecture').height(fhlMidWindowH*0.9);
        $('#fhlMidBottomWindowContent').hide();
        ps.leftBtmWinShow=false;
      }else{
        var fhlMidWindowH=$('#fhlMidWindow').height();
        $('#fhlMidBottomWindow').height(fhlMidWindowH*0.5);//5%->50%
        var fhlMidBottomWindowH=$('#fhlMidBottomWindow').height();
        $('#fhlMidBottomWindowTitle').height(fhlMidBottomWindowH*0.1);
        $('#fhlMidBottomWindowContent').height(fhlMidBottomWindowH*0.9);        
        $('#fhlLecture').height(fhlMidWindowH*0.5);
        $('#fhlMidBottomWindowContent').show();
        ps.leftBtmWinShow=true;
      }
      var html=(ps.leftBtmWinShow==true)?"&#9661":"&#9651";
      html+="fhlMidBottomWindowTitle";
      $('#fhlMidBottomWindowTitle').html(html);
    });*/
  },
  render:function(ps,dom){

      var html=(ps.leftBtmWinShow==true)?"&#9661":"&#9651";
      html+="fhlMidBottomWindowTitle";
      $('#fhlMidBottomWindowTitle').html(html);
      
      var fhlMidBottomWindowHeight = 100;
      $('#fhlMidBottomWindow').css({'top': $('#fhlMidWindow').height()-fhlMidBottomWindowHeight + 'px'});
      /*if(ps.leftBtmWinShow==false){
        var fhlMidWindowH=$('#fhlMidWindow').height();
        $('#fhlMidBottomWindow').height(fhlMidWindowH*0.1);//50%->5%
        var fhlMidBottomWindowH=$('#fhlMidBottomWindow').height();
        $('#fhlMidBottomWindowTitle').height(fhlMidBottomWindowH);
        $('#fhlMidBottomWindowContent').height(0);
        $('#fhlLecture').height(fhlMidWindowH*0.9);
        $('#fhlMidBottomWindowContent').hide();
      }else{
        var fhlMidWindowH=$('#fhlMidWindow').height();
        $('#fhlMidBottomWindow').height(fhlMidWindowH*0.5);//5%->50%
        var fhlMidBottomWindowH=$('#fhlMidBottomWindow').height();
        $('#fhlMidBottomWindowTitle').height(fhlMidBottomWindowH*0.1);
        $('#fhlMidBottomWindowContent').height(fhlMidBottomWindowH*0.9);        
        $('#fhlLecture').height(fhlMidWindowH*0.5);
        $('#fhlMidBottomWindowContent').show();
      }*/
  }
};
/***** End of fhlMidWindow *****/

/***** Start of fhlInfo *****/
var fhlInfo={
  init:function(ps){
    bibleAudio.init(ps,$('#bibleAudio'));
    bibleAudio.registerEvents(ps);  
    fhlInfoTitle.init(ps,$('#fhlInfoTitle'));
    fhlInfoTitle.registerEvents(ps);
    fhlInfoContent.init(ps,$('#fhlInfoContent'));    
    fhlInfoContent.registerEvents(ps);
    parsingPopUp.init(ps,$('#parsingPopUp'));
    this.registerEvents();
    this.render(ps);
      var fhlInfoWidth = 500;//這邊改了，css裡面也要改
    $('#fhlInfo').css({'left': $(window).width()-fhlInfoWidth + 'px'});
  },
  registerEvents:function(){
      $('#fhlInfo').resizable({
        handles: 'w',
        maxWidth: 650,
        minWidth: 280,
        resize: function(event, ui){
            var currentWidth = ui.size.width;
            var width=0;
            if($("#fhlLeftWindow").css('left')=='0px')
                width=$(window).width()-$("#fhlLeftWindow").width()-currentWidth;
            else
                width=$(window).width()-currentWidth;
            $("#fhlMidWindow").css({
              'width': width+'px',
              'right': currentWidth+'px'
            });
        }
      });
  },
  render:function(ps){
    //fhlInfoTitle.render(ps,$('#fhlInfoTitle'));
    fhlInfoContent.render(ps,fhlInfoContent.dom);
  }
};
    
var bibleAudio={
  init:function(ps,dom){
    this.dom=dom;
    this.render(ps,this.dom);
  },
  registerEvents:function(ps){

  },
  render:function(ps,dom){
    var html="有聲聖經 ";
    if(ps.chineses==book[0]&&ps.chap==1){
      html+="";
    }else{
      html+="<img class='menuImage' src='./images/lastChapter.png'/>";    
    }      
    if(ps.audio==0){
      html+="<img class='menuImage' src='./images/audioPlay.png'/>";    
    }else{
      html+="<img class='menuImage' src='./images/audioPause.png'/>";    
    }    
    if(ps.chineses==book[65]&&ps.chap==22){
      html+="";
    }else{
      html+="<img class='menuImage' src='./images/nextChapter.png'/>";
    }    
    dom.html(html);
  }
}

var fhlInfoTitle={
  init:function(ps,dom){
    this.dom=dom;
    this.title=[
              {"name":"原文","id":"fhlInfoParsing"},
              {"name":"注釋","id":"fhlInfoComment"},
              {"name":"講道","id":"fhlInfoPreach"},
              {"name":"串珠","id":"fhlInfoTsk"},
              {"name":"典藏","id":"fhlInfoOb"},
              {"name":"搜尋","id":"fhlInfoSearch"}
      ];    
    this.render(ps,this.dom);    
  },
  registerEvents:function(ps){
    //select all elements of info title
    var selectAll="";
    for(var i=0;i<this.title.length;i++){
      selectAll+="#"+this.title[i].id+",";      
    }    
    selectAll=selectAll.substring(0,selectAll.length-1);
    $(selectAll).click(function(){      
      $(selectAll).removeClass('selected');
      $(this).addClass('selected');
      ps.titleId=$(this).attr('id');
      fhlInfoContent.render(ps,fhlInfoContent.dom);
    });
  },  
  render:function(ps,dom){
    var html="<ul>";
    for(var i=0;i<this.title.length;i++){
      html+="<li>"+this.title[i].name+"</li>";
    }
    html+="</ul>";
    dom.html(html);
    for(var i=0;i<this.title.length;i++){
      dom.find('li:eq('+i+')').attr('id',this.title[i].id);
    }  
    $('#'+ps.titleId).addClass('selected');  
  }
};

var fhlInfoContent={
  init:function(ps,dom){
    this.dom=dom;
    this.render(ps,this.dom);
  },
  registerEvents:function(ps){
    var that=this;
    switch(ps.titleId){
      case "fhlInfoParsing":
        if(ps.realTimePopUp==1){
          $('.parsing').mouseenter(function(){
            var offset=$(this).offset();
            offset.top+=$(this).height()+10;
            ps.N=$(this).attr('N');
            ps.k=$(this).attr('k');
            var par=decodeURIComponent($(this).attr('par'));
            parsingPopUp.render(ps,parsingPopUp.dom,offset,par);
          });
          /*$('.parsing').mouseleave(function(){
            parsingPopUp.dom.hide();
          });*/
          $('.parsingTable').mouseenter(function(){
            var offset=$(this).offset();
            offset.top+=$(this).height()+10;
            ps.N=$(this).attr('N');
            ps.k=$(this).attr('k');
            parsingPopUp.render(ps,parsingPopUp.dom,offset,"psn");
          });
          /*$('.parsingTable').mouseleave(function(){
            parsingPopUp.dom.hide();
          });*/
        }else{
          $('.parsing').click(function(){
            var offset=$(this).offset();
            offset.top+=$(this).height()+10;
            ps.N=$(this).attr('N');
            ps.k=$(this).attr('k');
            var par=decodeURIComponent($(this).attr('par'));
            parsingPopUp.render(ps,parsingPopUp.dom,offset,par);
          });
          $('.parsingTable').click(function(){
            var offset=$(this).offset();
            offset.top+=$(this).height()+10;
            ps.N=$(this).attr('N');
            ps.k=$(this).attr('k');
            parsingPopUp.render(ps,parsingPopUp.dom,offset,"psn");
          });                    
        }

        $('.secBack').click(function(){
          var oldEngs=ps.engs;
          var oldChap=ps.chap;
          ps.engs=$(this).attr('engs');
          var idx=getBookFunc('indexByEngs',ps.engs);
          ps.chineses=book[idx];          
          ps.chap=$(this).attr('chap');
          ps.sec=$(this).attr('sec');          
          bookSelect.render(ps,bookSelect.dom);
          if(oldEngs!=ps.engs||oldChap!=ps.chap)
            fhlLecture.render(ps,fhlLecture.dom);
          fhlInfo.render(ps);
          fhlLecture.selectLecture(null,null,ps.sec);
        });
        $('.secNext').click(function(){
          var oldEngs=ps.engs;
          var oldChap=ps.chap;
          ps.engs=$(this).attr('engs');
          var idx=getBookFunc('indexByEngs',ps.engs);
          ps.chineses=book[idx];          
          ps.chap=$(this).attr('chap');
          ps.sec=$(this).attr('sec');          
          bookSelect.render(ps,bookSelect.dom);
          if(oldEngs!=ps.engs||oldChap!=ps.chap)
            fhlLecture.render(ps,fhlLecture.dom);            
          fhlInfo.render(ps);          
          fhlLecture.selectLecture(null,null,ps.sec);
        });
        break;
      case "fhlInfoComment":
        $('.commentSecBack, .commentSecNext, .commentBackground, .commentJump').click(function(){
          var oldEngs=ps.engs;
          var oldChap=ps.chap;
          ps.engs=$(this).attr('engs');
          var idx=getBookFunc('indexByEngs',ps.engs);
          ps.chineses=book[idx];
          ps.chap=$(this).attr('chap');
          ps.sec=$(this).attr('sec');
          bookSelect.render(ps,bookSelect.dom);
          if(oldEngs!=ps.engs||oldChap!=ps.chap)
            fhlLecture.render(ps,fhlLecture.dom);
          fhlInfo.render(ps);
          $('#fhlInfoContent').scrollTop(0);
        });
        $('.commentSecBack').css({
            "display": "block",
            "color": "rgba(100, 100, 100, 0.3)",
            "cursor": "pointer",
            "position": "absolute",
            "left": "0px",
            "height": "80px",
            "width": "40px", 
            "font-size": "3em",
            "line-height": "80px"
        }).hover(function(){
            $('.commentSecBack').css({
                "color": "rgba(255, 0, 0, 1)"/*,
                "background": "linear-gradient(to right, rgba(100,100,100,1), rgba(0,0,0,0))"*/
            })}, function(){
            $('.commentSecBack').css({
                "color": "rgba(100, 100, 100, 0.3)"/*,
                "background": "rgba(0, 0, 0, 0)"*/
            });}
        );
        $('.commentSecNext').css({
            "display": "block",
            "color": "rgba(100, 100, 100, 0.3)",
            "cursor": "pointer",
            "position": "absolute",
            "right": "0px",
            "height": "80px",
            "width": "50px", 
            "font-size": "3em",
            "line-height": "80px"
        }).hover(function(){
            $('.commentSecNext').css({
                "color": "rgba(255, 0, 0, 1)"/*,
                "background": "linear-gradient(to left, rgba(100,100,100,1), rgba(0,0,0,0))"*/
            })}, function(){
            $('.commentSecNext').css({
                "color": "rgba(100, 100, 100, 0.3)"/*,
                "background": "rgba(0, 0, 0, 0)"*/
            });}
        );
        $('.commentBackground').css({
            "display": "inline-block",
            "cursor": "pointer",
            "font-size": "20px",
            "color": "rgba(200, 200, 200, 1)",
            "background": "rgba(0, 70, 0, 1)",
            "border-radius": "5px",
            "width": "150px"
        }).hover(function(){
            $('.commentBackground').css({
                "color": "rgba(255, 0, 0, 1)",
                "background": "rgba(0,90,0,1)"
            })}, function(){
            $('.commentBackground').css({
                "color": "rgba(200, 200, 200, 1)",
                "background": "rgba(0, 70, 0, 1)",
                "border-radius": "5px"
            });}
        );
        $('.commentJump').css({
            "display": "inline-block",
            "cursor": "pointer",
            "color": "rgba(50, 50, 100, 1)"
        }).hover(function(){
            $(this).css({
                "color": "rgba(200, 0, 0, 1)",
                "text-decoration": "underline"
            })}, function(){
            $(this).css({
                "color": "rgba(50, 50, 100, 1)",
                "text-decoration": "none"
            });}
        );
        break;
      default:
        break;
    }
  },
  render:function(ps,dom){
    var that=this;
    switch(ps.titleId){
      case "fhlInfoParsing":
        var html="";
        var ajaxUrl=getAjaxUrl("qp",ps);
        $.ajax({
          url:ajaxUrl
        }).done(function(d,s,j){
          if(j){                  
            var jsonObj=JSON.parse(j.responseText);
            var v_name=jsonObj.v_name;
            var version=jsonObj.version;
            var prev_chineses=jsonObj.prev.chineses;
            var prev_engs=jsonObj.prev.engs;
            var prev_chap=jsonObj.prev.chap;
            var prev_sec=jsonObj.prev.sec;
            var next_chineses=jsonObj.next.chineses;
            var next_engs=jsonObj.next.engs;
            var next_chap=jsonObj.next.chap;
            var next_sec=jsonObj.next.sec;
            var proc=jsonObj.proc;
            var div_name=ps.titleId;
            if (version=="cbol") proc=10;//原文直譯
            var orig_font;
            var head_str="";
            var body_str="";
            var clrstr="";
            var clrcnt=0;
            var N=jsonObj.N;
            if (N==0) orig_font="g1";
            else    orig_font="g2";
            var html=jsonObj.N+"</br>";
            for (var i=0;i<jsonObj.record.length;i++){
                var wid=jsonObj.record[i].wid;
                var word=jsonObj.record[i].word;
                var exp=jsonObj.record[i].exp;
                var id=jsonObj.record[i].id;
                var parallel="";
                var align_str="";
                if (wid==0)
                {
                    if (N==0)//NT
                    {
                        var wstr="";
                        var wd=word.split("+");
                        if (wd.length>0)
                        {
                            for (var ii=0;ii<wd.length;ii++)
                            {
                                if (ii%3==0)
                                    wstr=wstr+wd[ii];
                                else if (ii%3==1)
                                    wstr=wstr+"(韋："+wd[ii]+")";
                                else if (ii%3==2)
                                    wstr=wstr+"(聯："+wd[ii]+")";
                            }
                            word=wstr;
                        }
                    }
                    else if (N==1) //OT
                    {
                        var remark=jsonObj.record[i].remark;
                        var engs=jsonObj.record[i].engs;
                        if (remark.length>0)
                        {
                                parallel="平行經文："+remark;
                        }
                        align_str="align=\"right\" style=\"padding:0px 10px 0px 0px;\"";
                    }

                    var bookName=getBookFunc("bookFullName",ps.chineses);
                    if(bookName!="failed"){                      
                      if(ps.chineses==book[0]&&ps.chap==1&&ps.sec==1){
                        head_str+="";
                      }else{
                        head_str+="<span class='secBack' ";
                        head_str+="engs="+prev_engs+" chap="+prev_chap+" sec="+prev_sec;
                        head_str+=">&#x25C0</span>";
                      }      
                      head_str+="<span>"+bookName;
                      head_str+="&nbsp&nbsp"+ps.chap+":"+ps.sec+"</span>";
                      if(ps.chineses==book[65]&&ps.chap==22&&ps.sec==21){
                        head_str+="";
                      }else{
                        head_str+="<span class='secNext' ";
                        head_str+="engs="+next_engs+" chap="+next_chap+" sec="+next_sec;
                        head_str+=">&#x25B6</span>";
                      }
                    }                                        
                    /*
                    var poverhead="",noverhead="";                    
                    if (prev_chineses!=chineses||prev_chap!=chap)
                        poverhead=";Gclick=false;Gsec="+prev_sec+";read_bible('"+chineses+"',"+prev_chap+");";
                    if (next_chineses!=chineses||next_chap!=chap)
                        noverhead=";Gclick=false;Gsec="+next_sec+";read_bible('"+chineses+"',"+next_chap+");";
                        head_str="<span style=\"font-size:150%;\"><a href=\"javascript:spar('"+prev_engs+"',"+prev_chap+","+prev_sec+",'"+div_name+"')"+
                        poverhead+"\">&lt;</a> <span class=\"psn\">"+
                        chinesef+"  "+chap+":"+sec
                        +"</span> <a href=\"javascript:spar('"+next_engs+"',"+next_chap+","+next_sec+",'"+div_name+"')"+
                        noverhead+"\">&gt;</a></span> "+parallel+"<br/>";
                    */
                   var nword=word.split("\n");
                   var nexp=exp.split("\n");                                      
                   if (N==1){//OT                                 
                      var wid=1;                   
                      for (var ii=0;ii<nword.length;ii++){                                                
                        var t=nword[nword.length-ii-1].split(" ");
                        //console.dir(t);                                                
                        head_str+="<div>";
                        for (var iii=0;iii<t.length;iii++){                          
                          //console.log(t[iii]);
                          if(t[iii].indexOf("-")==-1){
                            var sn=jsonObj.record[wid].sn;
                            var wform=jsonObj.record[wid].wform;
                            var orig=jsonObj.record[wid].orig;
                            var remark=jsonObj.record[wid].remark;
                            var exp1=jsonObj.record[wid].exp;
                            var par=encodeURIComponent(wform+'|'+orig+'|'+exp1+'|'+remark+'|');
                            head_str+="<span class=parsing N=1 k="+sn+" par="+par+">";
                            head_str+=t[iii]+"&nbsp</span>";
                            wid++;
                          }else{
                            var s=t[iii].split("-");
                            for(iiii=0;iiii<s.length;iiii++){
                              var sn=jsonObj.record[wid].sn;
                              var wform=jsonObj.record[wid].wform;
                              var orig=jsonObj.record[wid].orig;
                              var remark=jsonObj.record[wid].remark;
                              var exp1=jsonObj.record[wid].exp;
                              var par=encodeURIComponent(wform+'|'+orig+'|'+exp1+'|'+remark+'|');
                              head_str+="<span class=parsing N=1 k="+sn+" par="+par+">";
                              if(iiii==0)
                                head_str+=s[iiii]+"-</span>";
                              else
                                head_str+=s[iiii]+"&nbsp</span>";
                              wid++;
                            }                            
                          }
                        }
                        head_str+="</div>";
                        head_str+="<div>"+nexp[ii]+"</div>";                        
                      }
                   }
                   else if (N==0){
                      var wid=1;
                      for (var ii=0;ii<nword.length;ii++){
                        var t=nword[ii].split(" ");
                        head_str+="<div>";
                        for (var iii=0;iii<t.length;iii++,wid++){
                          var sn=jsonObj.record[wid].sn;
                          var pro=jsonObj.record[wid].pro;
                          var wform=jsonObj.record[wid].wform;
                          var orig=jsonObj.record[wid].orig;
                          var remark=jsonObj.record[wid].remark;
                          var exp1=jsonObj.record[wid].exp;
                          var par=encodeURIComponent(pro+'|'+wform+'|'+orig+'|'+exp1+'|'+remark+'|');
                          head_str+="<span class=parsing N=0 k="+sn+" par="+par+">";
                          head_str+=t[iii]+"&nbsp</span>";
                        }
                        head_str+="</div>";
                        head_str+="<div>"+nexp[ii]+"</div>";                        
                      }                          
                   }
             }
             else
            {
                if (N==0 && word=="+") {
                    clrcnt=(clrcnt+1)%3;
                    if (clrcnt==0) clrstr="";
                    else if (clrcnt==1) clrstr="#ffff99";
                    else if (clrcnt==2) clrstr="#ffcccc";
                    msg=skip1tag(msg,"record");
                    continue;
                } 
                var sn=jsonObj.record[i].sn;
                var pro=jsonObj.record[i].pro;
                var wform=jsonObj.record[i].wform;
                var orig=jsonObj.record[i].orig;
                var remark=jsonObj.record[i].remark;
                var pt=remark.indexOf("[#");
                var pt1=remark.indexOf("#]");
                while (N==1 && pt>=0 && pt1>pt)
                {
                    var nstr="";
                    var pstr=remark.substring(pt+2,pt1);
                    pstr=pstr.replace(/１/g,"1");
                    pstr=pstr.replace(/２/g,"2");
                    pstr=pstr.replace(/３/g,"3");
                    pstr=pstr.replace(/４/g,"4");
                    pstr=pstr.replace(/５/g,"5");
                    pstr=pstr.replace(/６/g,"6");
                    pstr=pstr.replace(/７/g,"7");
                    pstr=pstr.replace(/８/g,"8");
                    pstr=pstr.replace(/９/g,"9");
                    pstr=pstr.replace(/．/g,".");
                    subheb=pstr.split(",");
                    nstr="§";
                    for (si=0;si<subheb.length;si++)
                    {
                        subheb[si]=subheb[si].trim();
                        if (subheb[si].length==0) continue;
                        spt=subheb[si].split("-");
                        nstr=nstr+"<a href=\"/new/pimg/"+spt[0]+".png\" target=\"grammer\">"+subheb[si]+"</a> ";
                    }
                    remark=remark.substring(0,pt)+nstr+remark.substring(pt1+2);
                    pt=remark.indexOf("[#");
                    pt1=remark.indexOf("#]");
                }
                body_str=body_str+"<tr bgcolor=\""+clrstr+"\"><td class=\""+orig_font+"\">"+word+"</td><td class=\"g0\"><span class=\"parsingTable\" N="+N+" k="+sn+">"+sn+"</span></td><td class=\"g0\">";
                if (N==0)
                    body_str=body_str+pro+"</td><td class=\"g0\">";
                body_str=body_str+wform+"</td><td class=\""+orig_font+"\">"+orig+"</td><td class=\"g0\">"+exp+"</td><td class=\"g0\">"
                        +remark+"</td></tr>";
             }//else
            }//for I
             var ptg="";
             if (N==0)
                ptg="<td class=\"g0\">詞性</td>";
            dom.html("<div style=\"height:25%;overflow:auto;\">"+head_str+"</div><div style=\"height:70%;overflow:auto;\"><hr/><table border=\"1\">"+
     "<tr><td class=\"g0\">原文字</td><td class=\"g0\">SN</td>"+ptg+"<td class=\"g0\">字彙分析</td><td class=\"g0\">原型</td><td class=\"g0\">原型簡義</td><td class=\"g0\">備註</td>"+body_str+"</table></div>");
            that.registerEvents(ps);
          }//if j
        });
        //tjm      
        break;
      case "fhlInfoComment":
        var html="";
        var ajaxUrl=getAjaxUrl("sc",ps);
        //console.log(ajaxUrl);
        $.ajax({
          url:ajaxUrl
        }).done(function(d,s,j){
          if(j){                  
            function parseComment(t){                    
              t=t.replace(/\n/g,"</br>");
              t=t.replace(/ /g,"&nbsp");
              var pt,pt1;
              var tok, tok_str;
              var span_str;
              var i=0;
              while(true){
                pt=t.indexOf("#");
                pt1=t.indexOf("|");
                if(pt<0||pt1<0||pt1<=pt)
                  break;
                tok_str=t.substring(pt+1,pt1);
                span_str="";

                while(tok_str.length!==0){
                    var firstTokEnd = tok_str.indexOf(";");
                    if(firstTokEnd===-1)
                        firstTokEnd = tok_str.length;
                    tok = tok_str.substring(0, firstTokEnd);
                    tok_str = tok_str.substring(firstTokEnd+1, tok_str.length);

                    span_str += "&nbsp;<span class='commentJump' engs=";
                    var secNumberEnd = tok.indexOf("-");
                    if(secNumberEnd === -1)
                        secNumberEnd = tok.length;
                    var chapNumberEnd = tok.indexOf(":");
                    var secNumber = tok.substring(chapNumberEnd+1, secNumberEnd);
                    if(!isNaN(tok[0])){ // parse 在同一卷書裡面跳的
                        var chapNumber = tok.substring(0, chapNumberEnd);
                        span_str += ps.engs;
                    }
                    else{ // parse 有中文字在前面的
                        var bookNameEnd = tok.indexOf("&nbsp");
                        var bookName = tok.substring(0, bookNameEnd);
                        var chapNumber = tok.substring(bookNameEnd+5, chapNumberEnd);//+5是因為&nbsp
                        span_str += bookEng[book.indexOf(bookName)];
                    }
                    span_str += " chap=" + chapNumber + " sec='" + secNumber + "'>"+tok+"</span>&nbsp;";
                }
                t=t.substring(0,pt)+span_str+t.substring(pt1+1);
              }
              return t;
            }
            var jsonObj=JSON.parse(j.responseText);
            var prev_engs;
            var prev_chap;
            var prev_sec;
            var next_engs;
            var next_chap;
            var next_sec;
            var head_str="";
            var control_str="";

            if(jsonObj.hasOwnProperty('prev')){
                prev_engs=jsonObj.prev.engs;
                prev_chap=jsonObj.prev.chap;
                prev_sec=jsonObj.prev.sec;
                control_str+="<div class='commentSecBack' ";
                control_str+="engs="+prev_engs+" chap="+prev_chap+" sec="+prev_sec;
                control_str+=">&#x276e;</div>";
            }
            
            if(jsonObj.hasOwnProperty('next')){
                next_engs=jsonObj.next.engs;
                next_chap=jsonObj.next.chap;
                next_sec=jsonObj.next.sec;
                control_str+="<div class='commentSecNext' ";
                control_str+="engs="+next_engs+" chap="+next_chap+" sec="+next_sec;
                control_str+=">&#x276f;</div>";
            }
            
            if(ps.chap!=0&&ps.sec!=0){
                head_str+="<div style='position: absolute; display: block; width: 100%; height: 80px; text-align: center; font-size: 1.3em; line-height: 50px; margin: 0px;'>";
                head_str+=control_str;
                head_str+= jsonObj.record[0].title;
                head_str+="<div style='display: block; line-height: 100%;'>"
                head_str+="<span class='commentBackground' ";
                head_str+="engs="+ps.engs+" chap="+0+" sec="+0;
                head_str+=">書卷背景</span></div>";
            }
            else{
                var idx=getBookFunc('indexByEngs',ps.engs);
                head_str+="<div style='display: block; text-align: center; font-size: 1.3em; line-height: 50px;'>" + bookFullName[idx] +"&nbsp;背景資料</div>";
            }
            
            head_str+="</div>";

            var html=jsonObj.record[0].com_text;
            html=parseComment(html);
            html="<div style='display: absolute; padding: 0px; top: 0px; bottom: 0px; overflow: auto;'>" + head_str + '<div id="commentContent" style="position: absolute; top: 80px; left: 10px; right: 10px; bottom: 0px; display: block;  overflow: auto; word-wrap: break-word; word-break: normal; ">' + html + "</div></div>";

              /*height:' + ($(window).height()-200) + 'px;*/
            dom.html(html);
            
            that.registerEvents(ps);
          }
        });
        break;
      case "fhlInfoPreach":
        var html=ps.titleId;
        dom.html(html);      
        break;
      case "fhlInfoTsk":
        var html=ps.titleId;
        dom.html(html);      
        break;
      case "fhlInfoOb":
        var html=ps.titleId;
        dom.html(html);      
        break;
      case "fhlInfoSearch":
        var html=ps.titleId;
        dom.html(html);      
        break;                                        
    }
  }
};
var parsingPopUp={
  init:function(ps,dom){
    this.dom=dom;
    this.dom.hide();
  },
  registerEvents:function(ps){
    var that=this;
    this.dom.mouseleave(function(){
      that.dom.hide();
      that.dom.css({
        'overflow':'hidden',
        'height': 'auto'
      });
    });
    this.dom.mousedown(function(e){
      if(e.which==3){
        that.dom.unbind('mouseleave');
      }
    });
  },
  render:function(ps,dom,offset,par){
    var that=this;    
    if(par=="psn"){
      var ajaxUrl=getAjaxUrl('sd',ps);
      $.ajax({
        url:ajaxUrl
      }).done(function(d,s,j){      
        var jsonObj=JSON.parse(j.responseText);      
        var html=jsonObj.record[0].dic_text;
        html=html.replace(/\r\n/g,"</br>");
        dom.html(html);                  
        var lecTop=164;
        var lecTopOffset=120;
        var RightWinH=$('#fhlInfo').height();
        var domH=dom.height();
        console.log("top:"+offset.top+",domH:"+domH+",RightWinH:"+RightWinH);

        if(domH>RightWinH){
          //set css to auto scroll
        }else if(offset.top+domH>RightWinH){
          offset.top-=(offset.top>domH)?domH:offset.top;
          offset.left+=70;
        }    
        that.dom.show();
        dom.offset(offset);
        that.registerEvents(ps);
      });            
    }else if(par!=null){      
      var html=par;      
      dom.html(html);                  
      that.dom.show();
      dom.offset(offset);
      //that.dom.scrollTop(0);      
      that.registerEvents(ps);
    }else{
      var ajaxUrl=getAjaxUrl('sd',ps);
      $.ajax({
        url:ajaxUrl
      }).done(function(d,s,j){      
        var jsonObj=JSON.parse(j.responseText);      
        var html=jsonObj.record[0].dic_text;
        html=html.replace(/\r\n/g,"</br>");
        dom.html(html);                  
        var lecTop=164;
        var lecTopOffset=120;
        var leftWinH=$('#fhlMidWindow').height();
        var lecH=$('#fhlLecture').height();
        var scrollY=$('#fhlLecture').scrollTop();
        var scrollH=$('#fhlLecture')[0].scrollHeight;
        var domH=dom.height();
        console.log("top:"+offset.top+",domH:"+domH+",leftWinH:"+leftWinH+",lecH:"+lecH);
        console.log("scrollH:"+scrollH+",scrollY:"+scrollY);        

        if(domH>leftWinH){
          //set css to auto scroll
        }else if(offset.top+domH>leftWinH){
          offset.top-=(offset.top>domH)?domH:offset.top;
          offset.left+=50;
        }
/*
        if((offset.top+domH+scrollY)>scrollH){

        }
        else if((offset.top+domH)>leftWinH){
          $('#fhlLecture').scrollTop(scrollY+offset.top-lecTop);
          offset.top-=offset.top-lecTop;
        }
*/
        that.dom.show();
        dom.offset(offset);
        that.registerEvents(ps);
      });
    }
  }
};
/***** End of fhlInfo *****/
</script>
</head>
<body>
<!-- Layer 1-->
<div id="fhlTopMenu">
	<img id="logoFHL" src="./images/logoTopMenuFHL.png"/>
</div>
<div id="fhlToolBar">
    <div id="searchTool" class="smallText"></div>
    <div id="middleBox">
        <div id="bookSelect"></div>
        <div id="versionSelect"></div>
    </div>
    
    <div id="windowControl"></div>
</div>
<div id="fhlLeftWindow" class="leftWindow">
    <div class="leftWindowInside">
        <div id="settings">
            <p>&#9660;&nbsp;設定</p>
            <ul>
                <li><div id="snSelect"></div></li>
                <li><div id="realTimePopUpSelect"></div></li>
                <li><div id="gbSelect"></div></li>
                <li><div id="fontSizeTool"></div></li>
                <li><div id="mapTool"></div></li>
                <li><div id="imageTool"></div></li>
            </ul>
        </div>
        <div id="viewHistory">
            <p>&#9660;&nbsp;歷史紀錄</p>
            <ul>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
                <li>一筆紀錄</li>
            </ul>

        </div>
    </div>
</div>
<div id="fhlMidWindow">
    <div id="fhlLecture"></div>
    <div id="fhlMidBottomWindow">
      <div id="fhlMidBottomWindowTitle"></div>
      <div id="fhlMidBottomWindowContent">
        Content of fhlMidBottomWindowContent
      </div>
    </div>
</div>
<div id="fhlInfo">
  <div id="bibleAudio"></div>
  <div id="fhlInfoTitle"></div>
  <div id="fhlInfoContent"></div>
</div>
<!-- Layer 2 windows that hide after mouse leave-->
<div id="bookSelectPopUp">
  <div id="bookSelectName"></div>
  <div id="bookSelectChapter"></div>
</div>
<div id="versionSelectPopUp"></div>
<div id="parsingPopUp"></div>
<!-- Layer 3 windows that exists after mouse leave-->
<div id="dictionaryPopUp"></div>
</body>
</html>